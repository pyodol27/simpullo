{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'main.css' %}">
    <title>lcl</title>
</head>

<body>
    <table>
        <thead>
            <tr>
                <td>id</td>
                <td>origin</td>
                <td>dest</td>
                <td>name</td>
                <td>rate</td>
                <td>chargeAt</td>
                <td>group</td>
                <td>update/delete</td>
            </tr>
        <tbody class="tbody">
            {% for i in info %}
            <tr class="tr{{i.id}}">
                <td><input type="text" value="{{i.id}}" class="id{{i.id}}" disabled></td>
                <td><input type="text" value="{{i.origin}}" id="origin" class="origin{{i.id}}" disabled></td>
                <td><input type="text" value="{{i.dest}}" class="dest{{i.id}}" disabled></td>
                <td><input type="text" value="{{i.name}}" class="name{{i.id}}" disabled></td>
                <td><select id="" class="cur{{i.id}}" disabled>
                        <option value="{{i.cur}}">{{i.cur}}</option>
                        <option value="====">====</option>
                        <option value="USD">USD</option>
                        <option value="KRW">KRW</option>
                    </select>
                    <input type="text" value="{{i.rate}}" class="rate{{i.id}}" disabled>
                    <select id="" class="unit{{i.id}}" disabled>
                        <option value="{{i.unit}}">{{i.unit}}</option>
                        <option value="===">===</option>
                        <option value="BL">BL</option>
                        <option value="KG">KG</option>
                    </select>
                </td>
                <td><select id="" class="chargeAt{{i.id}}" disabled>
                        <option value="{{i.chargeAt}}">{{i.chargeAt}}</option>
                        <option value="===">===</option>
                        <option value="origin">origin</option>
                        <option value="freight">freight</option>
                        <option value="destination">destination</option>
                    </select></td>
                <td><input type="text" value="{{i.group}}" class="group{{i.id}}" disabled></td>
                <td><button class="editbtn{{i.id}}" id="{{i.id}}" onclick="editbtn(this.id)">수정</button>
                    <!-- <button class="updatebtn{{i.id}}" id="{{i.id}}" onclick="updaterate(this.id)"
                        style="display : none;">저장</button> -->
                    <!-- Button trigger modal -->
                    <button type="button" class="updatebtn{{i.id}}" data-bs-toggle="modal" data-bs-target="#updateModal{{i.id}}" style="display : none;">
                        저장
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="updateModal{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Update</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    변동사항을 저장하시겠습니까?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">아니오</button>
                                    <button class="updatebtn{{i.id}} btn btn-primary" id="{{i.id}}" onclick="updaterate(this.id)" data-bs-dismiss="modal"
                                    style="display : none;">예</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="cancelbtn{{i.id}}" id="{{i.id}}" onclick="cancelrate(this.id)"
                        style="display : none;">취소</button>
                    <!-- <button class="deletebtn{{i.id}}" id="{{i.id}}" onclick="showdeletemodal(this.id)">삭제</button> -->
                    <button type="button" id="{{i.id}}" class="deletebtn{{i.id}}" data-bs-toggle="modal"
                        data-bs-target="#deleteModal{{i.id}}">
                        삭제
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="deleteModal{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Delete</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    삭제하시겠습니까?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">아니오</button>
                                    <button class="deletebtn{{i.id}} btn btn-primary" id="{{i.id}}" onclick="deleterate(this.id)"
                                        data-bs-dismiss="modal">예</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
        </thead>
    </table>
    lcl페이지임
    <input type="text" placeholder="origin" class="origin">
    <input type="text" placeholder="dest" class="dest">
    <input type="text" placeholder="name" class="name">
    <select id="" class="cur">
        <option value="USD">USD</option>
        <option value="KRW">KRW</option>
    </select>
    <input type="text" placeholder="rate" class="rate">
    <select id="" class="unit">
        <option value="R/TON">R/TON</option>
        <option value="BL">BL</option>
        <option value="KG">KG</option>
    </select>
    <select id="" class="chargeAt">
        <option value="origin">origin</option>
        <option value="freight">freight</option>
        <option value="destination">destination</option>
    </select>
    <input type="text" placeholder="group" class="group">
    <button class="save">저장</button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script>
        $.ajaxSetup({
            headers: { "X-CSRFToken": "{{csrf_token}}" },
        });
    </script>
    <script>

        $('.save').on('click', function () {
            var origin = $('.origin').val();
            var dest = $('.dest').val();
            var name = $('.name').val();
            var cur = $('.cur').val();
            var rate = $('.rate').val();
            var unit = $('.unit').val();
            var chargeAt = $('.chargeAt').val();
            var group = $('.group').val();

            param = {
                origin: origin,
                dest: dest,
                name: name,
                cur: cur,
                rate: rate,
                unit: unit,
                chargeAt: chargeAt,
                group: group,
            }

            $.ajax({
                type: "POST",
                url: "{% url 'lcladd' %}",
                data: JSON.stringify(param),
                success: function (context) {
                    console.log('드디어 해냈다.')
                    var id = JSON.stringify(context.id).replace(/"/g, "");
                    var appendrow = `
                        <tr class="tr${id}">
                        <td>${id}</td>
                        <td>${origin}</td>
                        <td>${dest}</td>
                        <td>${name}</td>
                        <td>${cur}${rate}${unit}</td>
                        <td>${chargeAt}</td>
                        <td>${group}</td>
                        <td><button id="${id}">수정</button><button id="${id}" onclick="deleterate(this.id)">삭제</button></td>
                        </tr>
                        `
                    $('.tbody').append(appendrow)
                }

            })
        })

        function deleterate(id) {

            param = { id: id }
            $.ajax({
                type: "POST",
                url: "{% url 'lcldelete' %}",
                data: JSON.stringify(param),
                success: function () {
                    console.log('삭제 성공.')
                    $('.tr' + id).remove()
                    $('.black-bg').addClass('hide');
                    $('.aamodal').addClass('hide');
                    $('.deletemodal' + id).addClass('hide');
                }
            })
        }

        function showdeletemodal(id) {
            $('.black-bg').removeClass('hide');
            $('.aamodal').removeClass('hide');
            $('.deletemodal' + id).removeClass('hide');
        }


        function editbtn(id) {
            $('.updatebtn' + id).css('display', '');
            $('.cancelbtn' + id).css('display', '');
            $('.editbtn' + id).css('display', 'none');
            $('.deletebtn' + id).css('display', 'none');
            $('.origin' + id).attr('disabled', false);
            $('.dest' + id).attr('disabled', false);
            $('.name' + id).attr('disabled', false);
            $('.cur' + id).attr('disabled', false);
            $('.rate' + id).attr('disabled', false);
            $('.unit' + id).attr('disabled', false);
            $('.chargeAt' + id).attr('disabled', false);
            $('.group' + id).attr('disabled', false);
        }
        function cancelrate(id) {
            $('.editbtn' + id).css('display', '');
            $('.deletebtn' + id).css('display', '');
            $('.updatebtn' + id).css('display', 'none');
            $('.cancelbtn' + id).css('display', 'none');
            $('.origin' + id).attr('disabled', true);
            $('.dest' + id).attr('disabled', true);
            $('.name' + id).attr('disabled', true);
            $('.cur' + id).attr('disabled', true);
            $('.rate' + id).attr('disabled', true);
            $('.unit' + id).attr('disabled', true);
            $('.chargeAt' + id).attr('disabled', true);
            $('.group' + id).attr('disabled', true);
        }

        function updaterate(id) {

            var origin = $('.origin' + id).val();
            var dest = $('.dest' + id).val();
            var name = $('.name' + id).val();
            var cur = $('.cur' + id).val();
            var rate = $('.rate' + id).val();
            var unit = $('.unit' + id).val();
            var chargeAt = $('.chargeAt' + id).val();
            var group = $('.group' + id).val();

            param = {
                id: id,
                origin: origin,
                dest: dest,
                name: name,
                cur: cur,
                rate: rate,
                unit: unit,
                chargeAt: chargeAt,
                group: group,
            }
            $.ajax({
                type: "POST",
                url: "{% url 'lclupdate' %}",
                data: JSON.stringify(param),
                success: function (context3) {
                    $('.updatebtn' + id).css('display', 'none');
                    $('.cancelbtn' + id).css('display', 'none');
                    $('.editbtn' + id).css('display', '');
                    $('.deletebtn' + id).css('display', '');
                    $('.origin' + id).attr('disabled', true);
                    $('.dest' + id).attr('disabled', true);
                    $('.name' + id).attr('disabled', true);
                    $('.cur' + id).attr('disabled', true);
                    $('.rate' + id).attr('disabled', true);
                    $('.unit' + id).attr('disabled', true);
                    $('.chargeAt' + id).attr('disabled', true);
                    $('.group' + id).attr('disabled', true);

                }
            })

        }
    </script>


</body>

</html>